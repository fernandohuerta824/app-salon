const app=()=>{const e=JSON.parse(localStorage.getItem("cita"))??{nombre:document.querySelector("input#nombre").value,fecha:"",hora:"",servicios:[]};(()=>{const t=document.querySelector(".tabs"),o=document.querySelector(".paginacion");let a=1;const s=()=>{console.log("Reservar Cita")},n=o=>{a=o<1?1:o>3?3:o,(()=>{const e=document.querySelector(".seccion.mostrar");e.classList.remove("mostrar"),e.classList.add("ocultar");const t=document.querySelector("#paso-"+a);t.classList.remove("ocultar"),t.classList.add("mostrar")})(),t.querySelector("button.actual").classList.remove("actual"),document.querySelector(`button[data-paso="${a}"]`).classList.add("actual"),(()=>{const e=document.querySelector("#siguiente"),t=document.querySelector("#anterior");1===a&&(t.classList.add("ocultar"),e.classList.remove("ocultar")),2===a&&(t.classList.remove("ocultar"),e.classList.remove("ocultar")),3===a&&(t.classList.remove("ocultar"),e.classList.add("ocultar"))})(),3===a&&(()=>{const t=document.querySelector(".resumen-datos");let o="";e.servicios.length<1?o="Selecciona los servicios":e.fecha?e.hora||(o="Selecciona la hora"):o="Selecciona la fecha y hora";const a=document.querySelector("#paso-3 p");if(t.innerHTML="",o)return a.textContent=o+" antes de continuar";a.textContent="Verifica que la informacion sea correcta";const{nombre:n,fecha:c,hora:r,servicios:i}=e,l=document.createElement("P");l.innerHTML=`<span>Nombre: </span> ${n}`;const d=new Date(c),u=d.getMonth(),m=d.getDate(),v=d.getFullYear(),p=document.createElement("P");p.innerHTML=`<span>Fecha: </span> ${Intl.DateTimeFormat("es-mx",{dateStyle:"full"}).format(new Date(Date.UTC(v,u,m)+1728e5))}`;const L=document.createElement("P");L.innerHTML=`<span>Hora: </span> ${r}`,t.append(l,p,L),i.forEach((e=>{const{id:o,precio:a,nombre:s}=e,n=document.createElement("DIV");n.classList.add("contenedor-servicio");const c=document.createElement("P");c.textContent=s;const r=document.createElement("P");r.innerHTML=`<span>Precio: </span> $${a}`,n.append(c,r),t.appendChild(n)}));const h=document.createElement("BUTTON");h.classList.add("boton"),h.textContent="Reservar Cita",h.addEventListener("click",s),t.appendChild(h)})()};t.addEventListener("click",(e=>{const t=+e.target.getAttribute("data-paso");t&&n(t)})),o.addEventListener("click",(e=>{const t=e.target;if(!t.classList.contains("boton"))return;const o=t.id;"siguiente"===o&&n(a+1),"anterior"===o&&n(a-1)}))})(),(()=>{const t=t=>{t.forEach((t=>{const{id:o,nombre:a,precio:s}=t,n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=a;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent=`$${s}`;const r=document.createElement("DIV");r.classList.add("servicio"),r.dataset.idServicio=o,r.appendChild(n),r.appendChild(c),r.addEventListener("click",(t=>(t=>{document.querySelector(`.servicio[data-id-servicio="${t.id}"]`).classList.toggle("seleccionado");const{servicios:o}=e;e.servicios.some((e=>e.id===t.id))?e.servicios=o.filter((e=>e.id!==t.id)):e.servicios=[...o,t],localStorage.setItem("cita",JSON.stringify(e))})({id:o,nombre:a,precio:s}))),e.servicios.some((e=>e.id===o))&&r.classList.add("seleccionado");document.querySelector("#servicios").appendChild(r)}))};(async()=>{try{const e="http://192.168.100.188:3000/api/servicios",o=await fetch(e);if(200!==o.status)return;const a=await o.json();t(a)}catch(e){}})()})(),(()=>{const t=document.querySelector("input#fecha"),o=document.querySelector("input#hora");t.value=e.fecha,o.value=e.hora;const a=(e,t,o,a)=>{t.textContent=a,o||(e.insertAdjacentElement("beforebegin",t),setTimeout((()=>t.remove()),5e3))};t.addEventListener("change",(s=>{let n=t.value;const c=new Date(n).getUTCDay(),r=t.closest(".campo"),i=r.previousElementSibling,l=i.classList.contains("error"),d=+o.value.split(":")[0];if(0===c){const a=document.createElement("P");a.classList.add("alerta","error"),a.textContent="El dia domingo no trabajamos, eliga otro dia",l||(r.insertAdjacentElement("beforebegin",a),setTimeout((()=>a.remove()),5e3)),n=t.value=o.value=e.hora=""}else if(6===c&&d&&(d<10||d>15)){const t=o.closest(".campo"),s=t.previousElementSibling.classList.contains("error"),n=document.createElement("P");n.classList.add("alerta","error"),a(t,n,s,"Horario no valido los sabados, horario sabados: 10:00 - 15:00"),o.value=e.hora=""}else l&&i.remove();e.fecha=n,localStorage.setItem("cita",JSON.stringify(e))})),o.addEventListener("change",(s=>{const n=t.value,c=new Date(n).getUTCDay();let r=o.value;const i=+o.value.split(":")[0],l=o.closest(".campo"),d=l.previousElementSibling,u=d.classList.contains("error"),m=document.createElement("P");m.classList.add("alerta","error"),Number.isFinite(c)?6===c&&(i<10||i>15)?(a(l,m,u,"Horario no valido los sabados, horario sabados: 10:00 - 15:00"),o.value=r=""):i<8||i>19?(a(l,m,u,"Horario no valido entre semana, horario entre semana: 08:00 - 19:00"),o.value=r=""):u&&d.remove():(a(l,m,u,"Seleccione primero una fecha"),o.value=r=""),e.hora=r,localStorage.setItem("cita",JSON.stringify(e))}))})()};document.addEventListener("DOMContentLoaded",(e=>{app()}));