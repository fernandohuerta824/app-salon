const app=()=>{const e=JSON.parse(localStorage.getItem("cita"))??{nombre:document.querySelector("input#nombre").value,fecha:"",hora:"",servicios:[]},t=document.querySelector("input#fecha"),o=document.querySelector("input#hora");(()=>{const a=document.querySelector(".tabs"),s=document.querySelector(".paginacion");let n=1;const c=(e,t,o)=>{const a=document.createElement("P");a.classList.add("mensaje",o),a.textContent=e.data[o];const s=document.querySelector(`p.mensaje.${o}`);s&&s.remove(),t.insertAdjacentElement("beforeend",a),setTimeout((()=>a.remove()),5e3)},r=async()=>{const a=document.querySelector(".resumen-datos");try{const s=JSON.stringify(e),n=await fetch(`${location.origin}/api/citas`,{method:"POST",headers:{"Content-Type":"application/json"},body:s}),r=await n.json();if(201!==n.status)return c(r,a,"error");document.querySelectorAll(".servicio").forEach((e=>{e.classList.remove("seleccionado")})),t.value="",o.value="",a.innerHTML="",c(r,a,"exito"),e.fecha="",e.hora="",e.servicios=[],localStorage.setItem("cita",JSON.stringify(e))}catch(e){c({data:{error:"Algo salio mal, intentelo despues"}},a,"error")}},i=t=>{n=t<1?1:t>3?3:t,(()=>{const e=document.querySelector(".seccion.mostrar");e.classList.remove("mostrar"),e.classList.add("ocultar");const t=document.querySelector("#paso-"+n);t.classList.remove("ocultar"),t.classList.add("mostrar")})(),a.querySelector("button.actual").classList.remove("actual"),document.querySelector(`button[data-paso="${n}"]`).classList.add("actual"),(()=>{const e=document.querySelector("#siguiente"),t=document.querySelector("#anterior");1===n&&(t.classList.add("ocultar"),e.classList.remove("ocultar")),2===n&&(t.classList.remove("ocultar"),e.classList.remove("ocultar")),3===n&&(t.classList.remove("ocultar"),e.classList.add("ocultar"))})(),3===n&&(()=>{const t=document.querySelector(".resumen-datos");let o="";e.servicios.length<1?o="Selecciona los servicios":e.fecha?e.hora||(o="Selecciona la hora"):o="Selecciona la fecha y hora";const a=document.querySelector("#paso-3 p");if(t.innerHTML="",o)return a.textContent=o+" antes de continuar";a.textContent="Verifica que la informacion sea correcta";const{nombre:s,fecha:n,hora:c,servicios:i}=e,l=document.createElement("P");l.innerHTML=`<span>Nombre: </span> ${s}`;const d=new Date(n),m=d.getMonth(),u=d.getDate(),v=d.getFullYear(),p=document.createElement("P");p.innerHTML=`<span>Fecha: </span> ${Intl.DateTimeFormat("es-mx",{dateStyle:"full"}).format(new Date(Date.UTC(v,m,u)+1728e5))}`;const h=document.createElement("P");h.innerHTML=`<span>Hora: </span> ${c}`,t.append(l,p,h),i.forEach((e=>{const{id:o,precio:a,nombre:s}=e,n=document.createElement("DIV");n.classList.add("contenedor-servicio");const c=document.createElement("P");c.textContent=s;const r=document.createElement("P");r.innerHTML=`<span>Precio: </span> $${a}`,n.append(c,r),t.appendChild(n)}));const L=document.createElement("BUTTON");L.classList.add("boton"),L.textContent="Reservar Cita",L.addEventListener("click",r),t.appendChild(L)})()};a.addEventListener("click",(e=>{const t=+e.target.getAttribute("data-paso");t&&i(t)})),s.addEventListener("click",(e=>{const t=e.target;if(!t.classList.contains("boton"))return;const o=t.id;"siguiente"===o&&i(n+1),"anterior"===o&&i(n-1)}))})(),(()=>{const t=t=>{t.forEach((t=>{const{id:o,nombre:a,precio:s}=t,n=document.createElement("P");n.classList.add("nombre-servicio"),n.textContent=a;const c=document.createElement("P");c.classList.add("precio-servicio"),c.textContent=`$${s}`;const r=document.createElement("DIV");r.classList.add("servicio"),r.dataset.idServicio=o,r.appendChild(n),r.appendChild(c),r.addEventListener("click",(t=>(t=>{document.querySelector(`.servicio[data-id-servicio="${t.id}"]`).classList.toggle("seleccionado");const{servicios:o}=e;e.servicios.some((e=>e.id===t.id))?e.servicios=o.filter((e=>e.id!==t.id)):e.servicios=[...o,t],localStorage.setItem("cita",JSON.stringify(e))})({id:o,nombre:a,precio:s}))),e.servicios.some((e=>e.id===o))&&r.classList.add("seleccionado");document.querySelector("#servicios").appendChild(r)}))};(async()=>{try{const e=`${location.origin}/api/servicios`,o=await fetch(e);if(200!==o.status)return;const a=await o.json();t(a)}catch(e){}})()})(),(()=>{t.value=e.fecha,o.value=e.hora;const a=(e,t,o,a)=>{t.textContent=a,o||(e.insertAdjacentElement("beforebegin",t),setTimeout((()=>t.remove()),5e3))};t.addEventListener("change",(s=>{let n=t.value;const c=new Date(n).getUTCDay(),r=t.closest(".campo"),i=r.previousElementSibling,l=i.classList.contains("error"),d=+o.value.split(":")[0];if(0===c){const a=document.createElement("P");a.classList.add("alerta","error"),a.textContent="El dia domingo no trabajamos, eliga otro dia",l||(r.insertAdjacentElement("beforebegin",a),setTimeout((()=>a.remove()),5e3)),n=t.value=o.value=e.hora=""}else if(6===c&&d&&(d<10||d>15)){const t=o.closest(".campo"),s=t.previousElementSibling.classList.contains("error"),n=document.createElement("P");n.classList.add("alerta","error"),a(t,n,s,"Horario no valido los sabados, horario sabados: 10:00 - 15:00"),o.value=e.hora=""}else l&&i.remove();e.fecha=n,localStorage.setItem("cita",JSON.stringify(e))})),o.addEventListener("change",(s=>{const n=t.value,c=new Date(n).getUTCDay();let r=o.value;const i=+o.value.split(":")[0],l=o.closest(".campo"),d=l.previousElementSibling,m=d.classList.contains("error"),u=document.createElement("P");u.classList.add("alerta","error"),Number.isFinite(c)?6===c&&(i<10||i>15)?(a(l,u,m,"Horario no valido los sabados, horario sabados: 10:00 - 15:00"),o.value=r=""):i<8||i>19?(a(l,u,m,"Horario no valido entre semana, horario entre semana: 08:00 - 19:00"),o.value=r=""):m&&d.remove():(a(l,u,m,"Seleccione primero una fecha"),o.value=r=""),e.hora=r,localStorage.setItem("cita",JSON.stringify(e))}))})()};document.addEventListener("DOMContentLoaded",(e=>{app()}));